<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Product Import Wizard Form View -->
    <record id="view_product_import_wizard_form" model="ir.ui.view">
        <field name="name">tl.inventor.product.import.wizard.form</field>
        <field name="model">tl.inventor.product.import.wizard</field>
        <field name="arch" type="xml">
            <form string="Import Products from Inventor BOM">
                <group invisible="state != 'upload'">
                    <group>
                        <field name="file" filename="filename" widget="binary"/>
                        <field name="filename" invisible="1"/>
                    </group>
                    <group>
                        <field name="match_field"/>
                        <field name="create_missing"/>
                        <field name="update_existing"/>
                        <field name="default_category_id"/>
                    </group>
                </group>
                <group invisible="state != 'done'">
                    <field name="result_message" nolabel="1" colspan="2"/>
                </group>
                <field name="state" invisible="1"/>
                <footer>
                    <button name="action_import" string="Import" type="object" class="btn-primary" invisible="state != 'upload'"/>
                    <button name="action_close" string="Close" type="object" class="btn-secondary" invisible="state != 'done'"/>
                    <button string="Cancel" class="btn-secondary" special="cancel" invisible="state != 'upload'"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Product Import Wizard Action -->
    <record id="action_product_import_wizard" model="ir.actions.act_window">
        <field name="name">Import Inventor BOM</field>
        <field name="res_model">tl.inventor.product.import.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <!-- Menu item for Product Import (under Inventory > Configuration) -->
    <menuitem id="menu_product_import_wizard"
              name="Import Inventor BOM"
              parent="stock.menu_stock_config_settings"
              action="action_product_import_wizard"
              sequence="100"/>

    <!-- Booking BOM Import Wizard Form View -->
    <record id="view_booking_bom_import_wizard_form" model="ir.ui.view">
        <field name="name">tl.inventor.booking.bom.import.wizard.form</field>
        <field name="model">tl.inventor.booking.bom.import.wizard</field>
        <field name="arch" type="xml">
            <form string="Importera BOM till Booking">
                <field name="state" invisible="1"/>
                <field name="booking_id" invisible="1"/>
                <field name="preview_data" invisible="1"/>
                <field name="missing_data" invisible="1"/>
                
                <!-- Upload State -->
                <group invisible="state != 'upload'">
                    <group colspan="2">
                        <field name="file" filename="filename" widget="binary" string="Excel-fil (.xlsx)"/>
                        <field name="filename" invisible="1"/>
                    </group>
                    <group>
                        <field name="replace_existing"/>
                    </group>
                </group>
                
                <!-- Confirm State (Preview) -->
                <group invisible="state != 'confirm'">
                    <div class="alert alert-info" role="alert" colspan="2">
                        <strong>Förhandsgranskning</strong>
                    </div>
                    <group>
                        <field name="matched_count" string="Matchade produkter"/>
                        <field name="missing_count" string="Saknade produkter"/>
                    </group>
                    <group invisible="missing_count == 0">
                        <field name="create_missing_products" string="Skapa saknade produkter"/>
                    </group>
                    <group invisible="not duplicates_warning" colspan="2">
                        <div class="alert alert-warning" role="alert">
                            <strong>⚠️ Dubbletter kommer summeras:</strong>
                            <pre><field name="duplicates_warning" nolabel="1" readonly="1"/></pre>
                        </div>
                    </group>
                    <group invisible="not missing_products" colspan="2">
                        <div class="alert alert-warning" role="alert">
                            <strong>⚠️ Produkter som saknas:</strong>
                            <pre><field name="missing_products" nolabel="1" readonly="1"/></pre>
                        </div>
                    </group>
                </group>
                
                <!-- Done State -->
                <group invisible="state != 'done'">
                    <field name="result_message" nolabel="1" colspan="2"/>
                </group>
                
                <footer>
                    <button name="action_preview" string="Förhandsgranska" type="object" class="btn-primary" invisible="state != 'upload'"/>
                    <button name="action_import" string="Importera" type="object" class="btn-primary" invisible="state != 'confirm'"/>
                    <button name="action_back" string="Tillbaka" type="object" class="btn-secondary" invisible="state != 'confirm'"/>
                    <button name="action_close" string="Stäng" type="object" class="btn-secondary" invisible="state != 'done'"/>
                    <button string="Avbryt" class="btn-secondary" special="cancel" invisible="state == 'done'"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Booking BOM Import Wizard Action -->
    <record id="action_booking_bom_import_wizard" model="ir.actions.act_window">
        <field name="name">Importera BOM</field>
        <field name="res_model">tl.inventor.booking.bom.import.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
</odoo>
